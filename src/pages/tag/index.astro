---
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { SITE_TITLE } from "../../consts";
import { getCollection } from "astro:content";
import { slugifyTag } from "../../lib/tag";
import EmojiIcon from "../../components/EmojiIcon.astro";

const posts = (await getCollection("blog", ({ data }) => !data.draft)).sort(
	(a, b) => b.data.createdAt.valueOf() - a.data.createdAt.valueOf(),
);
const map = new Map<string, { name: string; slug: string; count: number }>();
for (const post of posts) {
	for (const tag of post.data.tags || []) {
		const slug = slugifyTag(tag);
		const entry = map.get(slug) || { name: tag, slug, count: 0 };
		if (!map.has(slug)) {
			map.set(slug, entry);
		}
		entry.count++;
	}
}
const tags = Array.from(map.values()).sort((a, b) =>
	a.name.localeCompare(b.name),
);
---
<head>
  <BaseHead title={`${SITE_TITLE} Tags`} />
</head>
<body>
  <Header />
  <main class="fade-in w-full max-w-[960px] mx-auto p-4 max-[768px]:p-2">
    <ul class="list-none p-0 flex flex-wrap gap-2 leading-6">
      {tags.map((c) => (
        <li>
          <a
            href={`/tag/${c.slug}/`}
            class="inline-block px-2 py-1 bg-[var(--surface)] rounded-[var(--surface-radius)] no-underline shadow"
          >
            <EmojiIcon>🏷️</EmojiIcon> {c.name} ({c.count})
          </a>
        </li>
      ))}
    </ul>
  </main>
  <Footer />
</body>

